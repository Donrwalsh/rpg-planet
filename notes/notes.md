# Notes

Bare bones starter. I used some tutorials and guidance from the LittleJS repo to get this together. Run the app then click anywhere on the screen and a blue square shows up. It moves to the left until it hits a wall and then stops. Nifty.

Clicking a bunch spawns many boxes and their physics is not exactly what I want. Ideally there'd be collision with the walls (and ceiling and floor) and then a different kind of collision when running into other boxes. Maybe none at all? I feel like there should be something to showcase how many boxes are active in a given cluster rather than the end result of just piling on the same box space eventually. So, a task is to learn more about how physics works.

Otherwise, I have plans for rpg elements to happen in this hallway: boxes attacking the wall until it crumbles and such. Plenty of time for that. Though, maybe it'd be worth looking into how I might pull sprites in to better graphically represent all this? Ok, so that's two tasks that'll branch out from here.

- [ ] Learn more about the physics engine
- [x] Sprites? How that interplays with physics and representing my current, simple ideas.

Went looking for some free assets and found something called LPC which has the art style that I'm looking for and seems to be somewhat standardized. I produced a standard sprite sheet for the male character and downloaded it into my project. I'm still calling it `download.png` rather than updating `tiles.png` for now. Got it from https://liberatedpixelcup.github.io/Universal-LPC-Spritesheet-Character-Generator which seems really awesome, even though the LPC itself doesn't exist anymore.

I got my example app reading from the tile sheet properly (though it seems like it'll be tricky to eventually have a bunch of these, but I'll figure that out later). Furthermore the page wghere I generated this thing has some helpful previews that work to isolate which sprites I'm actually after. I used the Animation example to get the generic male character to walk left and it looks great! This is a good spot for a checkpoint commit.

But before I do that, I played around some more with the spritesheet generator. I'm not sure how I'm supposed to make use of this? If I, say, wanted a varied collection of sprites to generate I guess I need a full sprite sheet for each? There seems to be something where I can export just the items and just the characters so maybe I can fuss with that later. In addition, the only 'action' attacks that are properly animated in the way that I'd expect are spaced differently and are much larger than the other sprites. Interesting.

I can export just the walk and slash animations (and I guess the death animation, but that only faces the camera for some reason) and so maybe this is the method I'd use to reduce the amount of space eaten up by assets. At least, that's what makes the most sense for now.

- [ ] Take what I learned about sprites and apply them to the blue boxes. Walking animation while strolling and then attack animation once it reaches the wall. Just do one npc to start with.
- [ ] Look back into the sprite atlas now that I know how this works kinda

So here's what I'm thinking: You've got the sprites themselves which are one representation of the npc, but then also the shapes that can serve as their collision portion and be positioned as a sort of central 'shadow' point underneath the feet. This should create a cool grouping effect and I can also use different shapes to represent different classes of npcs!

It is functional for a single npc, but gets weird when there are multiple. Granted, the offsetting bit is working with the ceiling having collision, but the floor doesn't and when I tried to add a random selection between up or down it didn't work quite right. Also there appears to be some bouncing happening off the wall and other npcs. Pretty pleased with how this is looking. The blue square could be more at the feet, but it's also pretty cool centered as is currently.

### 9/24/25

First things first, I migrated my work into a folder named `hallway` so I can work on separate aspects of the app if/when I choose to.

The next thing I'd like to work on is establishing the core NPC class contract. The immediate thing that comes to mind is movement. I'm currently establishing the npc with static movement that is then adjusted as certain events occur (collision). Rather than this, I'd like the NPC itself to be in charge of its own movement. So the replacement for the current behavior is some sort of algorithm wherein the NPC looks at its environment enough to understand what its movement protocol is and then executes it, repeating this until it dies or the game ends. So to start, let's update things so it's not a mouse click that spawns a square but instead an npc that spawns automatically so I can observe its behavior swiftly.

Ok, my code is a mess so I'm going to clean it up a bit too. I worked this for a while. There is unfortunately no 'is currently colliding' check that I can plug into to decide if the npc should be attacking or walking. So I set it up like this: The NPC proceeds until it can't move anymore. At which point it assumes that it has been impeded by some sort of object that it can attack (a safe assumption since the wall is the only thing it can run into right now). Next, while in the attacking state the NPC gets a different animation and a timer is set. Once that timer is elapsed, an attack is executed and then I check to see if the target was destroyed. If it was, then attacking is turned off and the NPC begins moving again. If not, the timer resets and another attack is queued.

To test this out, I added attackSpeed and attackDamage to the NPC. I also added a raw HP value to the wall, and enough variables to track its present health. With that, I let the app run and an NPC spawns, approaches the wall, kills it, and proceeds to the left. Bingo, that's a pretty nice checkpoint!

Alright, I did some more on this. I updated the floor so that it exists in the same way as the ceiling (this was relevant for collisions) and then made the wall slightly larger to avoid some weird squeeze-through behavior I was seeing. This took a lot of tinkering, but I wanted to get the behavior in place of the multiple npcs 'crowding' a stop-point. Firstly, the collision is based on the geometric shape behind the sprite, which was what I wanted so that's good. Secondly, I can actually know what game element the sprite is colliding with via some clever logic on the collision checking function. Though, this caused an issue with npcs never de-spawning due to the lack of an `attacking` check on the logic that sets up the attack timer: When there are a lot of npcs crowded into a single spot they are constantly re-triggering that collision and therefore resetting the attack timer without ever executing an attack. That would've been a tricky one to track down.

Anyway, the way it works is that when an NPC collides with anything it'll decide what to do based on what it ran into (added the `!attacking` check here ~ and then refactored my logic to account for the fact that I need that check for all of these). If it collides with a ceiling or floor it will continue moving in the same direction but it will invert gravity, thus 'bouncing' off the ceiling or floor (this locks me into a collision-bound hallway but I don't mind that at least right now). If the npc runs into a wall, it'll stop moving and start attacking (this existed before this commit). Lastly, if it collides with another NPC it will attempt to adjust its position. It does so by setting a timer so that only one adjustment happens at once (otherwise, since the collision will still be happening the sprite just stutters as it switches back and forth indefinitely) and then it attempts to perform an adjustment. The adjustment amounts to randomly deciding between up or down and then setting the npc on that path. So it's very similar to the 'bouncing' off the ceiling or floor, but the random nature adds some character to how all the npcs try to crowd around a smaller space to attack. Overall, I'm pleased with how this looks and feels in its current form. There's the occasional rogue npc that likes to slide off to the right, but it happens pretty sparingly and only when I absolutely inundate the screen with npcs. The small amount of screen space that I'm using here means that I can pretty easily crowd all the available hallway space with blocking npcs, at which point new NPCs do crazy things, sometimes completely breaking free of my hallway. So I added logic that kills an NPC after they perform an attack (imagine spiked walls or something) and even with no death animation I like the behavior of how new NPCs fill in the blanks when their predecessors fall.

Then I did a slight adjustment to the way I calculate sprite time so that they aren't all taking the same system time calculation and so it avoids all the sprites syncing up. I also, as part of this work, adjusted the positioning of the collision box so that it makes a decent base for the sprite itself. This required two different calculations based on the static or active sprite selection.
